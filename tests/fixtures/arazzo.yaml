arazzo: 1.0.0
info:
  title: User Registration and Profile Update Flow
  description: |
    A complete workflow that demonstrates user registration, login, and profile update.
    This workflow tests the typical user journey in the API.
  version: 1.0.0

sourceDescriptions:
  - name: userAPI
    url: ./openapi.yaml
    type: openapi

workflows:
  - workflowId: user-onboarding-flow
    summary: Complete user onboarding and profile setup
    description: |
      This workflow performs the following steps:
      1. Register a new user
      2. Login with the registered credentials
      3. Retrieve the user profile
      4. Update the user profile
    inputs:
      type: object
      properties:
        username:
          type: string
          default: testuser
        email:
          type: string
          default: test@example.com
        password:
          type: string
          default: securePassword123
        newEmail:
          type: string
          default: updated@example.com
        bio:
          type: string
          default: I am a test user

    steps:
      - stepId: register
        description: Register a new user account
        operationId: registerUser
        requestBody:
          contentType: application/json
          payload:
            username: $inputs.username
            email: $inputs.email
            password: $inputs.password
        successCriteria:
          - context: $statusCode
            condition: ==
            value: 201
        outputs:
          userId: $response.body.id
          username: $response.body.username

      - stepId: login
        description: Login with the registered user
        operationId: loginUser
        requestBody:
          contentType: application/json
          payload:
            username: $inputs.username
            password: $inputs.password
        successCriteria:
          - context: $statusCode
            condition: ==
            value: 200
        outputs:
          token: $response.body.token
          userId: $response.body.user.id

      - stepId: getProfile
        description: Retrieve the user profile
        operationId: getProfile
        parameters:
          - name: Authorization
            in: header
            value: Bearer $steps.login.outputs.token
        successCriteria:
          - context: $statusCode
            condition: ==
            value: 200
          - context: $response.body.id
            condition: ==
            value: $steps.register.outputs.userId
        outputs:
          profile: $response.body

      - stepId: updateProfile
        description: Update the user profile
        operationId: updateProfile
        parameters:
          - name: Authorization
            in: header
            value: Bearer $steps.login.outputs.token
        requestBody:
          contentType: application/json
          payload:
            email: $inputs.newEmail
            bio: $inputs.bio
        successCriteria:
          - context: $statusCode
            condition: ==
            value: 200
          - context: $response.body.email
            condition: ==
            value: $inputs.newEmail
        outputs:
          updatedProfile: $response.body

    successCriteria:
      - context: $steps.updateProfile.outputs.updatedProfile.email
        condition: ==
        value: $inputs.newEmail

    outputs:
      finalUserId: $steps.register.outputs.userId
      finalToken: $steps.login.outputs.token
      finalProfile: $steps.updateProfile.outputs.updatedProfile

  - workflowId: simple-login-flow
    summary: Simple login workflow
    description: A minimal workflow that just performs login
    inputs:
      type: object
      properties:
        username:
          type: string
          default: testuser
        password:
          type: string
          default: securePassword123

    steps:
      - stepId: login
        description: Login user
        operationId: loginUser
        requestBody:
          contentType: application/json
          payload:
            username: $inputs.username
            password: $inputs.password
        successCriteria:
          - context: $statusCode
            condition: ==
            value: 200
        outputs:
          token: $response.body.token

    outputs:
      authToken: $steps.login.outputs.token
